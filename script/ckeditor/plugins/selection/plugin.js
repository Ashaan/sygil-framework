/*
Copyright (c) 2003-2009, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/

(function(){var a=function(){var j=this;var g=j.getSelection();if(!g)return;var h=g.getStartElement(),i=new CKEDITOR.dom.elementPath(h);if(!i.compare(j._.selectionPreviousPath)){j._.selectionPreviousPath=i;j.fire('selectionChange',{selection:g,path:i,element:h});}},b,c,d=function(){c=true;if(b)return;e.call(this);b=CKEDITOR.tools.setTimeout(e,200,this);},e=function(){b=null;if(c){CKEDITOR.tools.setTimeout(a,0,this);c=false;}},f={exec:function(g){switch(g.mode){case 'wysiwyg':g.document.$.execCommand('SelectAll',false,null);break;case 'source':}}};CKEDITOR.plugins.add('selection',{init:function(g,h){g.on('contentDom',function(){if(CKEDITOR.env.ie)g.document.on('selectionchange',d,g);else{g.document.on('mouseup',d,g);g.document.on('keyup',d,g);}});g.addCommand('selectAll',f);g.ui.addButton('SelectAll',{label:g.lang.selectAll,command:'selectAll'});}});})();CKEDITOR.editor.prototype.getSelection=function(){var c=this;var a=c.document?c.document.getSelection():null;if(a&&CKEDITOR.env.ie){var b=a.getNative().createRange();if(!b)return null;else if(b.item)return b.item(0).ownerDocument==c.document.$?a:null;else return b.parentElement().ownerDocument==c.document.$?a:null;}return a;};CKEDITOR.dom.document.prototype.getSelection=function(){return new CKEDITOR.dom.selection(this);};CKEDITOR.SELECTION_NONE=1;CKEDITOR.SELECTION_TEXT=2;CKEDITOR.SELECTION_ELEMENT=3;CKEDITOR.dom.selection=function(a){this.document=a;this._={cache:{}};};(function(){var a={img:1,hr:1,li:1,table:1,tr:1,td:1,embed:1,object:1,ol:1,ul:1};CKEDITOR.dom.selection.prototype={getNative:CKEDITOR.env.ie?function(){return this._.cache.nativeSel||(this._.cache.nativeSel=this.document.$.selection);}:function(){return this._.cache.nativeSel||(this._.cache.nativeSel=this.document.getWindow().$.getSelection());},getType:CKEDITOR.env.ie?function(){var e=this;if(e._.cache.type)return e._.cache.type;var b=CKEDITOR.SELECTION_NONE;try{var c=e.getNative(),d=c.type;if(d=='Text')b=CKEDITOR.SELECTION_TEXT;if(d=='Control')b=CKEDITOR.SELECTION_ELEMENT;if(c.createRange().parentElement)b=CKEDITOR.SELECTION_TEXT;}catch(f){}return e._.cache.type=b;}:function(){var f=this;if(f._.cache.type)return f._.cache.type;var b=CKEDITOR.SELECTION_TEXT,c=f.getNative();if(!c)b=CKEDITOR.SELECTION_NONE;else if(c.rangeCount==1){var d=c.getRangeAt(0),e=d.startContainer;if(e==d.endContainer&&e.nodeType==1&&d.endOffset-d.startOffset==1&&a[e.childNodes[d.startOffset].nodeName.toLowerCase()])b=CKEDITOR.SELECTION_ELEMENT;}return f._.cache.type=b;
},getRanges:CKEDITOR.env.ie?(function(){var b=function(c,d){c=c.duplicate();c.collapse(d);var e=c.parentElement(),f=e.childNodes,g;for(var h=0;h<f.length;h++){var i=f[h];if(i.nodeType==1){g=c.duplicate();g.moveToElementText(i);g.collapse();var j=g.compareEndPoints('StartToStart',c);if(j>0)break;else if(j===0)return{container:e,offset:h};g=null;}}if(!g){g=c.duplicate();g.moveToElementText(e);g.collapse(false);}g.setEndPoint('StartToStart',c);var k=g.text.length;while(k>0)k-=f[--h].nodeValue.length;if(k===0)return{container:e,offset:h};else return{container:f[h],offset:-k};};return function(){var m=this;if(m._.cache.ranges)return m._.cache.ranges;var c=m.getNative(),d=c.createRange(),e=m.getType(),f;if(e==CKEDITOR.SELECTION_TEXT){f=new CKEDITOR.dom.range(m.document);var g=b(d,true);f.setStart(new CKEDITOR.dom.node(g.container),g.offset);g=b(d);f.setEnd(new CKEDITOR.dom.node(g.container),g.offset);return m._.cache.ranges=[f];}else if(e==CKEDITOR.SELECTION_ELEMENT){var h=m._.cache.ranges=[];for(var i=0;i<d.length;i++){var j=d.item(i),k=j.parentNode,l=0;f=new CKEDITOR.dom.range(m.document);for(;l<k.childNodes.length&&k.childNodes[l]!=j;l++){}f.setStart(new CKEDITOR.dom.node(k),l);f.setEnd(new CKEDITOR.dom.node(k),l+1);h.push(f);}return h;}return m._.cache.ranges=[];};})():function(){var g=this;if(g._.cache.ranges)return g._.cache.ranges;var b=[],c=g.getNative();for(var d=0;d<c.rangeCount;d++){var e=c.getRangeAt(d),f=new CKEDITOR.dom.range(g.document);f.setStart(new CKEDITOR.dom.node(e.startContainer),e.startOffset);f.setEnd(new CKEDITOR.dom.node(e.endContainer),e.endOffset);b.push(f);}return g._.cache.ranges=b;},getStartElement:function(){var f=this;var b,c=f.getNative();switch(f.getType()){case CKEDITOR.SELECTION_ELEMENT:return f.getSelectedElement();case CKEDITOR.SELECTION_TEXT:var d=f.getRanges()[0];if(d)if(!d.collapsed){d.optimize();b=d.startContainer;if(b.type!=CKEDITOR.NODE_ELEMENT)return b.getParent();b=b.getChild(d.startOffset);if(!b||b.type!=CKEDITOR.NODE_ELEMENT)return d.startContainer;var e=b.getFirst();while(e&&e.type==CKEDITOR.NODE_ELEMENT){b=e;e=e.getFirst();}return b;}if(CKEDITOR.env.ie){d=c.createRange();d.collapse(true);b=d.parentElement();}else{b=c.anchorNode;if(b.nodeType!=1)b=b.parentNode;}}return b?new CKEDITOR.dom.element(b):null;},getSelectedElement:function(){var b;if(this.getType()==CKEDITOR.SELECTION_ELEMENT){var c=this.getNative();if(CKEDITOR.env.ie)try{b=c.createRange().item(0);}catch(e){}else{var d=c.getRangeAt(0);b=d.startContainer.childNodes[d.startOffset];
}}return b?new CKEDITOR.dom.element(b):null;},reset:function(){this._.cache={};},selectElement:CKEDITOR.env.ie?function(b){this.getNative().empty();var c;try{c=this.document.$.body.createControlRange();c.addElement(b.$);}catch(d){c=this.document.$.body.createTextRange();c.moveToElementText(b.$);}c.select();}:function(b){var c=this.document.$.createRange();c.selectNode(b.$);var d=this.getNative();d.removeAllRanges();d.addRange(c);},selectRanges:CKEDITOR.env.ie?function(b){if(b[0])b[0].select();}:function(b){var c=this.getNative();c.removeAllRanges();for(var d=0;d<b.length;d++){var e=b[d],f=this.document.$.createRange();f.setStart(e.startContainer.$,e.startOffset);f.setEnd(e.endContainer.$,e.endOffset);c.addRange(f);}},createBookmarks:function(){var b=[],c=this.getRanges();for(var d=0;d<c.length;d++)b.push(c[d].createBookmark());return b;},selectBookmarks:function(b){var c=[];for(var d=0;d<b.length;d++){var e=new CKEDITOR.dom.range(this.document);e.moveToBookmark(b[d]);c.push(e);}this.selectRanges(c);return this;}};})();CKEDITOR.dom.range.prototype.select=CKEDITOR.env.ie?function(){var i=this;var a=i.collapsed,b,c,d=i.createBookmark(),e=d.startNode,f;if(!a)f=d.endNode;var g=i.document.$.body.createTextRange();g.moveToElementText(e.$);g.moveStart('character',1);if(f){var h=i.document.$.body.createTextRange();h.moveToElementText(f.$);g.setEndPoint('EndToEnd',h);g.moveEnd('character',-1);}else{b=(!e.hasPrevious()||e.getPrevious().is&&e.getPrevious().is('br'))&&(!e.hasNext());c=i.document.createElement('span');c.setHtml('&#65279;');c.insertBefore(e);if(b)i.document.createText('﻿').insertBefore(e);}i.setStartBefore(e);e.remove();if(a){if(b)g.select();else g.select();c.remove();}else{i.setEndBefore(f);f.remove();g.select();}}:function(){var d=this;var a=d.startContainer;if(d.collapsed&&a.type==CKEDITOR.NODE_ELEMENT&&!a.getChildCount())a.append(new CKEDITOR.dom.text(''));var b=d.document.$.createRange();b.setStart(a.$,d.startOffset);try{b.setEnd(d.endContainer.$,d.endOffset);}catch(e){if(e.toString().indexOf('NS_ERROR_ILLEGAL_VALUE')>=0){d.collapse(true);b.setEnd(d.endContainer.$,d.endOffset);}else throw e;}var c=d.document.getSelection().getNative();c.removeAllRanges();c.addRange(b);};
